#!/bin/execlineb -P
# SPDX-License-Identifier: EUPL-1.2+
# SPDX-FileCopyrightText: 2023-2024 Alyssa Ross <hi@alyssa.is>
# SPDX-FileCopyrightText: 2026 Demi Marie Obenour <demiobenour@gmail.com>

s6-ipcserver-socketbinder -B /run/wayland
fdmove -c 3 0

redirfd -r 0 /dev/null

# Notify readiness.
if { fdmove 1 5 echo }
fdclose 5

if { /etc/mdev/wait card0 }
if { /etc/mdev/wait renderD128 }

export LISTEN_FDS 1
export LISTEN_FDNAMES wayland
getpid LISTEN_PID

s6-setuidgid user

wl-cross-domain-proxy --listen-fd
