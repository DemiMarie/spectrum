#!/bin/execlineb -P
# SPDX-License-Identifier: EUPL-1.2+
# SPDX-FileCopyrightText: 2020-2021 Alyssa Ross <hi@alyssa.is>
# SPDX-FileCopyrightText: 2025 Yureka Lilian <yureka@cyberchaos.dev>

importas -Si INTERFACE

ifte

{
  # This interface is connected to the router
  if { xdp-loader load $INTERFACE /usr/lib/xdp/prog_router.o -m skb -p /sys/fs/bpf }
  if { ip link set $INTERFACE promisc on }
  if { set-router-iface $INTERFACE }
  ip link set $INTERFACE up
}

{
  if { test $INTERFACE != lo }
  # This is a physical connection to a network device.
  if { xdp-loader load $INTERFACE /usr/lib/xdp/prog_physical.o -m skb -p /sys/fs/bpf }
  if { ip link set $INTERFACE promisc on }
  ip link set $INTERFACE up
}

grep -iq ^02:01: /sys/class/net/${INTERFACE}/address
