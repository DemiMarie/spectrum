#!/bin/execlineb -S4
# SPDX-License-Identifier: EUPL-1.2+
# SPDX-FileCopyrightText: 2024 Alyssa Ross <hi@alyssa.is>

if -t { test -e /run/vm/by-id/${3}/config/providers/net }
cd /run/vm/by-id/${3}/config/providers/net
elglob -0 net_providers *
forx -pE net_provider { $net_providers }

if {
  ch-remote --api-socket /run/vm/by-name/${net_provider}/vmm
    remove-device router${4}
}

if { ip link set router${4} down name _dead${4} nomaster }
ip link del br${4}
