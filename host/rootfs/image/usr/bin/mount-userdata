#!/bin/execlineb -W
# SPDX-License-Identifier: EUPL-1.2+
# SPDX-FileCopyrightText: 2025 Alyssa Ross <hi@alyssa.is>

backtick -D "" uuid {
  importas -Siu 1
  blkid -o value -s UUID -- $1
}

multisubstitute {
  importas -Siu 0
  importas -Siu 1
  importas -Siu uuid
}

case $uuid {
  "" {
    fdmove -c 1 2
    printf "%s: '%s' does not have a UUID\n" $0 $1
  }
}

if { mount -m -t btrfs -o nosuid,nodev,noexec,nosymfollow -- $1 /media/${uuid} }
printf "%s\n" /media/${uuid}
