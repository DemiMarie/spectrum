#!/bin/execlineb -P
# SPDX-License-Identifier: EUPL-1.2+
# SPDX-FileCopyrightText: 2021, 2025 Alyssa Ross <hi@alyssa.is>

importas -Siu WAYLAND_DISPLAY

# Workaround for
# https://gitlab.freedesktop.org/wayland/weston/-/merge_requests/1911
if { mkdir -p -m 0700 /run/user/0 }

backtick USER { id -un }
backtick HOME {
  importas -i user USER
  homeof $user
}

redirfd -r 0 /dev/tty1

importas -i home HOME
cd $home
if { udevadm wait /dev/dri/card0 }
unshare --cgroup --ipc --net --uts
weston -S $WAYLAND_DISPLAY
