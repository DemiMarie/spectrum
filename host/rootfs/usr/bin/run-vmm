#!/bin/execlineb -s0
# SPDX-License-Identifier: EUPL-1.2+
# SPDX-FileCopyrightText: 2024 Alyssa Ross <hi@alyssa.is>

s6-ipcserver-socketbinder -B /run/vm/by-id/${1}/vmm

getpid -E vmm_pid
background -d {
  if -n { start-vmm $@ }
  kill $vmm_pid
}
unexport !
fdclose 3

cloud-hypervisor --api-socket fd=0
